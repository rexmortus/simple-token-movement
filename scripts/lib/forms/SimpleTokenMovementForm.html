<!-- Condition management -->
<div id="condition-management" class="hidden">
  <div class="flexcol">
    <h1>Conditions</h1>
    {{#each statusEffects}}
    <div class="token-controller-action {{#if (hasEffect ../character this.id)}}
          active-effect{{/if}}" data-event-type="condition" data-condition="{{this.id}}">

        <!-- Entry -->
      <div class="flexrow token-controller-action-entry status-effect">
        <img src="{{this.icon}}"/>
        <span>{{this.id}}</span>
      </div>

      <!-- Long Description -->
      <div class="token-controller-action-description hidden">
        This is a long description of this motherfucking stupid bullshit
      </div>
    </div>
  {{/each}}
  <a id="close-condition-management"><i class="fa-solid fa-circle-xmark"></i></a>
  </div>
</div>

<div id="hp-management" class="hidden">

  <div class="flexcol">
    <h1>HP Management</h1>
    <br>
    <div class="flexrow hp-display">
      <div class="flexcol">
        <span class="value" data-current-hp>{{character.system.attributes.hp.value}}</span>
        <span class="label">Current HP</span>
      </div>
      {{#if character.system.attributes.hp.temp includeZero=false}}
        <div class="flexcol">
          <span><i class="fa-solid fa-plus"></i></span>
        </div>
        <div class="flexcol">
          <span class="value temp-hp-value" data-current-temp-hp>{{character.system.attributes.hp.temp}}</span>
          <span class="label temp-hp-label">Temp HP</span>
        </div>
      {{/if}}
      <div class="flexcol">
        <span class="divider">/</span>
      </div>
      <div class="flexcol">
        <span class="value">{{character.system.attributes.hp.max}}</span>
        <span class="label">Max HP</span>
      </div>
    </div>
    <br>
    <div class="flexrow hp-controller">
      <button class="death-button" data-increment="death"><i class="fa-solid fa-skull"></i></button>
      <button class="minus-button" data-increment="-1"><i class="fa-solid fa-minus"></i></button>
      <input type="number" class="hp-controller-value" value="0" placeholder="0">
      <button class="plus-button" data-increment="1"><i class="fa-solid fa-plus"></i></button>
      <button class="heal-button" data-increment="heal"><i class="fa-solid fa-heart"></i></button>
    </div>
    <br>
    <div class="flexrow hp-damage-controls">
      <button data-damage-button="update" disabled>No Action</button>
    </div>
    <br>
    <h3>Advanced</h3>
    <br>
    <div class="flexrow hp-controller">
      <span>Temp HP</span>
      <input class="hp-controller-value" type="number" value="{{character.system.attributes.hp.temp}}">
    </div>
    <br>
    <div class="flexrow hp-controller">
      <span>Max HP Modifier</span>
      <input class="hp-controller-value" type="number">
    </div>
    <br>
    <div class="flexrow hp-controller">
      <span>Override Max HP</span>
      <input class="hp-controller-value" type="number">
    </div>
  
    <a id="close-hp-management"><i class="fa-solid fa-circle-xmark"></i></a>
  </div>
</div>

<!-- The actual controller -->
<div class="flexcol" class="dnd5e-mobile-controller" id="mobile-controller">
  
  {{!-- Top section --}}
  <div class="top-section">
    
    <!-- Top Section -->
    <h1 class="character-name">{{character.name}} <span class="class-details">{{characterClass.name}} {{characterClass.system.levels}}</span></h1>
    <div class="flexrow">
      
      <!-- Left buttons -->
      <div class="flexcol left-buttons">
        <button data-event-type="manage-conditions">Conditions</button>
        <button data-event-type="manage-rest">Rest</button>
      </div>
      <!-- Character Image -->
      <div class="flexcol character-image" style="background: url({{character.img}})"></div>
      <!-- Right Buttons -->
      <div class="flexcol right-buttons">
        <button data-event-type="manage-hp">{{totalHp}}/{{character.system.attributes.hp.max}} HP</button>
        <button data-event-type="manage-defenses">Defenses</button>
        <button data-event-type="manage-inspiration">Inspiration</button>
      </div>

    </div>

    <!-- Attributes -->
    <br>
    <div class="flexrow attributes">
      <div><span style="font-size: x-large;">{{prependSign character.system.attributes.prof}}</span><br>Prof. bonus</div>
      <div><span style="font-size: x-large;">{{character.system.attributes.ac.value}}</span><br>AC</div>
      <div><span style="font-size: x-large;">{{character.system.attributes.movement.walk}}</span><br>Movement</div>
      <div><span style="font-size: x-large;">{{prependSign character.system.attributes.init.total}}</span><br>Initiative</div>
    </div>

    <!-- Navigation -->

    <div class="flexrow ">
      <nav class="token-controller-tabs tabs" data-group="primary-tabs">
        <a class="item" data-tab="movement-tab" data-group="primary-tabs"><i class="fa-solid fa-arrows-up-down-left-right"></i></a>
        <a class="item" data-tab="actions-tab" data-group="primary-tabs"><i class="fa-solid fa-fire"></i></a>
        <a class="item" data-tab="abilities-skills-tab" data-group="primary-tabs"><i class="fa-solid fa-dice"></i></a>
        <a class="item" data-tab="spellcasting-tab" data-group="primary-tabs"><i class="fa-solid fa-wand-sparkles"></i></a>
        <a class="item" data-tab="inventory-tab" data-group="primary-tabs"><i class="fa-solid fa-suitcase"></i></a>
        <a class="item" data-tab="character-tab" data-group="primary-tabs"><i class="fa-solid fa-user"></i></a>
      </nav> 
    </div>  
  </div>

  <!-- Main Content -->
  <div class="flexrow">
    <section class="token-controller-content">
      
      <br>
      <!-- All goes inside a scrollable div -->
      <div class="scrollable-div">
          
      <!-- Movement tab -->
      <div class="tab movement-tab" data-tab="movement-tab" data-group="primary-tabs" style="height:440px">
        <h3>Movement</h3>
        <br>
        <div class="flexrow">
          <span class="mtmc-topleft"><i class="fa-solid fa-circle-arrow-up"></i></span>
          <span class="mtmc-top"><i class="fa-solid fa-circle-arrow-up"></i></span>
          <span class="mtmc-topright"><i class="fa-solid fa-circle-arrow-up"></i></span>
        </div>
        <div class="flexrow">
          <span class="mtmc-left"><i class="fa-solid fa-circle-arrow-up"></i></span>
          <span class="mtmc-select"><img class="character-token" src="{{character.prototypeToken.texture.src}}" alt=""></span>
          <span class="mtmc-right"><i class="fa-solid fa-circle-arrow-up"></i></span>
        </div>
        <div class="flexrow">
          <span class="mtmc-bottomleft"><i class="fa-solid fa-circle-arrow-up"></i></span>
          <span class="mtmc-bottom"><i class="fa-solid fa-circle-arrow-up"></i></span>
          <span class="mtmc-bottomright"><i class="fa-solid fa-circle-arrow-up"></i></span>  
        </div>
        <br>
        {{!-- <div class="flexrow zoom-controls">
          <span><i class="fa-solid fa-magnifying-glass-plus"></i></span>
          <span><i class="fa-solid fa-magnifying-glass-minus"></i></span>
        </div> --}}

      </div>
    
      <!-- Actions tab -->
      <div class="tab" data-tab="actions-tab" data-group="primary-tabs">
        <div class="simple-token-controller-actions">
          {{#each actionKeys}}
            <h3>{{toUpcase this}}</h3>
            <div class="token-controller-actions">
              {{#with (lookup ../actionList this) }}

                {{#each this}}
                  <div class="token-controller-action" data-event-type="action" data-action-subtype="action" data-action-index="{{@index}}">

                      <!-- Entry -->
                    <div class="flexrow token-controller-action-entry">
                      <img src="{{this.img}}"/>
                      <span>{{this.name}}</span>
                      <span>{{this.labels.activation}}</span>
                      <span style="text-align: center;">
                        {{#if this.labels.toHit}} {{this.labels.toHit}} to hit <br>{{/if}}
                        {{#each this.labels.derivedDamage}}
                          {{this.label}}
                        {{/each}}
                      </span>
                    </div>

                    <!-- Long Description -->
                    <div class="token-controller-action-description hidden">
                      {{{this.system.description.value}}}
                    </div>

                  </div>
                {{/each}}

              {{/with}}
            </div>  
          {{/each}}
        </div>
      </div>
    
      <!-- Abilities / Skills tab -->
      <div class="tab" data-tab="abilities-skills-tab" data-group="primary-tabs">
        <h3>Abilities</h3>
        <table>
          <thead>
            <tr>
              <th>Ability</th>
              <th>Value</th>
              <th>Modifier</th>
              <th>Save</th>
            </tr>
          </thead>
          {{#each character.system.abilities}}
            <tr class="token-controller-action" data-event-type="ability" data-ability="{{@key}}" style="text-align: center; font-size:16px">
              <td style="text-align: left;">
                {{#with (lookup ../abilityList @key) }}
                  {{label}}
                {{/with}}
              </td>
              <td>{{this.value}}</td>
              <td>{{this.mod}}</td>
              <td>{{this.save}}</td>
            </tr>
          {{/each}}
        </table>
    
        <!-- Skills -->
        <h3>Skills</h3>
        <table>
          <thead>
            <tr>
              <th>Skill</th>
              <th>Ability</th>
              <th>Total</th>
              <th>Passive</th>
            </tr>
          </thead>
          {{#each character.system.skills}}
            <tr class="token-controller-action" data-event-type="skill" data-skill="{{@key}}" style="text-align: center; font-size:16px">
              <td style="text-align: left;">
                {{#with (lookup ../skillList @key) }}
                  {{label}}
                {{/with}}
              </td>
              <td>{{this.ability}} <span style="color: grey;">({{this.mod}})</span></td>
              <td>{{this.total}}</td>
              <td style="color: grey;">{{this.passive}}</td>
            </tr>
          {{/each}}
        </table>
      </div>
    
      <!-- Spellcasting tab-->
      <div class="tab" data-tab="spellcasting-tab" data-group="primary-tabs">
        
        <!-- Wizard -->
        {{#equals characterClass.name 'Wizard'}}
        <h3>{{characterClass.name}} {{characterClass.system.levels}}</h3>
        <br>
        <div class="flexrow" style="text-align: center;">
          <div><span style="font-size: x-large;">{{character.system.attributes.spellcasting}}</span><br>Ability</div>
          <div><span style="font-size: x-large;">{{character.system.attributes.spelldc}}</span><br>Spell DC</div>
          <div><span style="font-size: x-large;">{{numOfSpellsPrepared}} / {{maxPrepared}}</span><br>Spells Prepared</div>  
        </div>
        {{/equals}}
    
        <!-- Sorcerer -->
        {{#equals characterClass.name 'Sorcerer'}}
        <h3>{{characterClass.name}} {{characterClass.system.levels}}</span></h3>
        <br>
        <div class="flexrow" style="text-align: center;">
          <div><span style="font-size: x-large;">{{character.system.attributes.spellcasting}}</span><br>Ability</div>
          <div><span style="font-size: x-large;">{{character.system.attributes.spelldc}}</span><br>Spell DC</div>
          <div><span style="font-size: x-large;">{{numCantripsKnown}} / {{character.system.scale.sorcerer.cantrips-known}}</span><br>Cantrips Known</div>  
          <div><span style="font-size: x-large;">{{numSpellsKnown}} / {{character.system.scale.sorcerer.spells-known}}</span><br>Spells Known</div>    
        </div>
        {{/equals}}
    
        <!-- Warlock -->
        {{#equals characterClass.name 'Warlock'}}
        <h3>{{characterClass.name}} {{characterClass.system.levels}}</span></h3>
        <br>
        <div class="flexrow" style="text-align: center;">
          <div><span style="font-size: x-large;">{{character.system.attributes.spellcasting}}</span><br>Ability</div>
          <div><span style="font-size: x-large;">{{character.system.attributes.spelldc}}</span><br>Spell DC</div>
          <div><span style="font-size: x-large;">{{numCantripsKnown}} / {{character.system.scale.sorcerer.cantrips-known}}</span><br>Cantrips Known</div>  
          <div><span style="font-size: x-large;">{{numSpellsKnown}} / {{character.system.scale.sorcerer.spells-known}}</span><br>Spells Known</div>    
        </div>
        {{/equals}}
    
        <!-- Paladin -->
        {{#equals characterClass.name 'Paladin'}}
        <h3>{{characterClass.name}} {{characterClass.system.levels}}</span></h3>
        <br>
        <div class="flexrow" style="text-align: center;">
          <div><span style="font-size: x-large;">{{character.system.attributes.spellcasting}}</span><br>Ability</div>
          <div><span style="font-size: x-large;">{{character.system.attributes.spelldc}}</span><br>Spell DC</div>
          <div><span style="font-size: x-large;">{{numCantripsKnown}} / {{character.system.scale.sorcerer.cantrips-known}}</span><br>Cantrips Known</div>  
          <div><span style="font-size: x-large;">{{numSpellsKnown}} / {{character.system.scale.sorcerer.spells-known}}</span><br>Spells Known</div>    
        </div>
        {{/equals}}
    
        <!-- Cleric -->
        {{#equals characterClass.name 'Cleric'}}
        <h3>{{characterClass.name}} {{characterClass.system.levels}}</span></h3>
        <br>
        <div class="flexrow" style="text-align: center;">
          <div><span style="font-size: x-large;">{{character.system.attributes.spellcasting}}</span><br>Ability</div>
          <div><span style="font-size: x-large;">{{character.system.attributes.spelldc}}</span><br>Spell DC</div>
          <div><span style="font-size: x-large;">{{numCantripsKnown}} / {{character.system.scale.sorcerer.cantrips-known}}</span><br>Cantrips Known</div>  
          <div><span style="font-size: x-large;">{{numSpellsKnown}} / {{character.system.scale.sorcerer.spells-known}}</span><br>Spells Known</div>    
        </div>
        {{/equals}}
    
        <!-- Artificer -->
        {{#equals characterClass.name 'Artificer'}}
        <h3>{{characterClass.name}} {{characterClass.system.levels}}</span></h3>
        <br>
        <div class="flexrow" style="text-align: center;">
          <div><span style="font-size: x-large;">{{character.system.attributes.spellcasting}}</span><br>Ability</div>
          <div><span style="font-size: x-large;">{{character.system.attributes.spelldc}}</span><br>Spell DC</div>
          <div><span style="font-size: x-large;">{{numCantripsKnown}} / {{character.system.scale.sorcerer.cantrips-known}}</span><br>Cantrips Known</div>  
          <div><span style="font-size: x-large;">{{numSpellsKnown}} / {{character.system.scale.sorcerer.spells-known}}</span><br>Spells Known</div>    
        </div>
        {{/equals}}

        <!-- Spell List -->
        {{#each spellList}}
        <div class="token-controller-actions">
          
          <!-- Spell Headings -->
          <br>
          <h3>
            {{#with (lookup ../spellLevels @key)}}
              {{this}}
            {{/with}}
            <span class="spell-slots">
              {{#with (lookup ../spellSlots @key) }}
                {{#if this.max includeZero=true}}
                  {{this.value}} / {{this.max}}  
                {{/if}}
              {{/with}}
            </span>
          </h3>
          {{#each this}}

          <!-- Spell Action -->
          <div class="token-controller-action" data-event-type="spell" data-spell-name="{{this.name}}">

              <!-- Entry -->
            <div class="flexrow token-controller-action-entry">
              <img src="{{this.img}}"/>
              <span>{{this.name}}</span>
              <span>{{this.labels.school}}</span>
              {{#if this.system.preparation.prepared}}
                <i class="original-class fas fa-sun" style="float: right;" data-tooltip="DND5E.ClassOriginal"></i>
              {{/if}}
            </div>

            <!-- Long Description -->
            <div class="token-controller-action-description hidden">
              {{{this.system.description.value}}}
            </div>

          </div>
          {{/each}}

        </div>
        {{/each}}
      </div>
    
      <!--Inventory tab-->
      <div class="tab" data-tab="inventory-tab" data-group="primary-tabs">
        {{#each inventoryList}}
        <h3>{{@key}}</h3>
          {{#each this}}
            <div class="token-controller-action" data-event-type="action" data-action-subtype="action" data-action-index="{{@index}}">

                <!-- Entry -->
              <div class="flexrow token-controller-action-entry">
                <img src="{{this.img}}"/>
                <span>{{this.name}}</span>
                <span>{{this.labels.activation}}</span>
                <span style="text-align: center;">
                  {{#if this.labels.toHit}} {{this.labels.toHit}} to hit <br>{{/if}}
                  {{#each this.labels.derivedDamage}}
                    {{this.label}}
                  {{/each}}
                </span>
              </div>

              <!-- Long Description -->
              <div class="token-controller-action-description hidden">
                {{{this.system.description.value}}}
              </div>

            </div>
          {{/each}}
      {{/each}}
      </div>
    
       <!--Character tab-->
       <div class="tab" data-tab="character-tab" data-group="primary-tabs">
        {{#each featureList}}
        <h3>{{@key}}</h3>
        <table>
          {{#each this}}
          <tr class="token-controller-action" style="text-align: left;">
            <td><img height="32px" width="32px" src="{{this.img}}" alt=""></td>
            <td style="text-align: left;">{{this.name}}</td>
          </tr>
          {{/each}}
        </table>
        {{/each}}
        </div>
    
    
      </div>
      
    </section>
  </div>
</div>